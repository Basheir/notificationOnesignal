<modification>

    <id>Notification onesignal</id>
    <version>1.3.0</version>
    <vqmver>2.1.1</vqmver>
    <author>BasheirHassan</author>


    <file name="admin/view/template/catalog/product_list.twig">
        <operation>
            <search position="before" index="1">
                <![CDATA[<div class="pull-right">]]></search>


            <add><![CDATA[

         <div class="btn-group">
          <button type="button" onclick="sendAllNotificationonesignal();" class="btn btn-warning">ارسال تنبيه OneSignal</button>
        </div>

			]]></add>

        </operation>




        <operation>
            <search position="before" index="1"><![CDATA[<script type="text/javascript"><!--]]></search>

            <add><![CDATA[

            <script type="text/javascript">
function sendAllNotificationonesignal() {

    var obj = $("input[name='selected[]']:checked:enabled");






    if (obj.length < 1) {
        alert('is not Checked');

        return;
    }


    var dialog = bootbox.dialog({
        title: 'ارسال اشعار ',
        message: ' <i id ="loading" class="fa fa-spin fa-spinner"></i> ' +
            ' <br/><input id="text" class="bootbox-input bootbox-input-email form-control"  type="text"><br/>' +
            '<input id="imgUrl" class="bootbox-input bootbox-input-email form-control"  type="text"><br/>' +
            '<input id="ID" class="bootbox-input bootbox-input-email form-control"  type="text"> <br/>' +
            '<select name="segment" id="segment"></select> اختيار المجموعة <br/>' +

            '<input class="sel" type="checkbox" name="iscat" id="iscat" value="true"> To Category -> <select name="cat" id="cat"></select><br/>' +
            '<input class="sel" type="checkbox" name="isManufacturer" id="isManufacturer" value="true"> To toManufacturer -> <select name="manufacturer" id="manufacturer"></select><br/>' +
            '<input class="sel" type="checkbox" name="isProduct" id="isProduct" value="true"> To Product<br/>' +

            '<input type="checkbox" name="sound" id="sound" value="true">ارسال التنبيه بدون صوت <br>' +
            '<input type="checkbox" name="active_url" id="active_url" value="true" >تفعيل رابط المنتج<br>',

        buttons: {
            cancel: {
                label: "الغاء",
                className: 'btn-danger',
                callback: function () {

                }
            },
            ok: {
                label: "ارسال",
                className: 'btn-info',
                callback: function () {


                    var sound = "false"
                    if ($("#sound").is(':checked')) {
                        sound = "true"
                    }

                    var active_url = ""
                    if ($("#active_url").is(':checked')) {
                        active_url = "true"
                    }



                     var iscat = ""
                    if ($("#iscat").is(':checked')) {
                        iscat = true;


                    }

                     var isManufacturer = ""
                    if ($("#isManufacturer").is(':checked')) {
                        isManufacturer = true;

                    }

                     var isProduct = ""
                    if ($("#isProduct").is(':checked')) {
                        isProduct = true;

                    }







                    $.getJSON("index.php?route=extension/module/notificationonesignal/send&user_token={{user_token}}", {
                        name: $("#text").val(),
                        imgUrl: $("#imgUrl").val(),
                        id: $("#ID").val(),
                        segment: $("#segment").val(),
                        active_url: active_url,
                        sound: sound,
                        iscat:iscat,
                        isManufacturer:isManufacturer,
                        isProduct:isProduct,
                        cat:$("#cat").val(),
                        manufacturer:$("#manufacturer").val()
                    })
                        .done(function (data) {

                            if (data.errors) {
                                bootbox.alert(" " + data.errors);
                            } else {
                                bootbox.alert("حالة الارسال" + data.recipients);

                            }

                        });
                    return false;


                }
            }
        }
    });


    $.ajax({
        url: 'index.php?route=extension/module/notificationonesignal/getProduct&user_token={{user_token}}',
        dataType: 'json',
        data: {id: obj.val()},
        success: function (data) {

            $("#loading").hide();
            $("#text").val(data.text);
            $("#imgUrl").val(data.imgUrl);
            $("#ID").val(data.ID);


            $.each(data.segment, function (key, val) {
                $("#segment").append('<option value="' + val + '">' + val + '</option>');

            });

        }

    });



    $.getJSON( "index.php?route=extension/module/notificationonesignal/getSection&user_token={{user_token}}", function( data ) {


        $("#cat").append("<option value=''></option>" );

        $.each( data, function( key, val ) {
            $("#cat").append("<option value='" + val.category_id + "'>" + val.name + "</option>" );
        });

        $("#cat").change(function() {
            $("#cat").val();
            $("#idCat").val( "c="+ $("#cat").val());

        });



    });




$.getJSON( "index.php?route=extension/module/notificationonesignal/getManufacturers&user_token={{user_token}}", function( data ) {


        $("#manufacturer").append("<option value=''></option>" );

        $.each( data, function( key, val ) {
            $("#manufacturer").append("<option value='" + val.manufacturer_id + "'>" + val.name + "</option>" );
        });

    });



   $('.sel').click(function() {
                        $('.sel').not(this).prop('checked', false);
                        $(this).prop('checked', true);
      });


}








</script>

			]]></add>

        </operation>


    </file>



</modification>
